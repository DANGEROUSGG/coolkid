-- Create the ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MyGUI"
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Create the Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 350)
frame.Position = UDim2.new(0.5, -150, 0.5, -175)
frame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
frame.Parent = screenGui
frame.Visible = true

-- Make the frame draggable
local dragging = false
local dragInput, dragStart, startPos

frame.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
    end
end)

frame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

frame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Create the Fly Button
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0, 150, 0, 50)
flyButton.Position = UDim2.new(0.5, -75, 0.7, -25)
flyButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
flyButton.Text = "Fly"
flyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
flyButton.Font = Enum.Font.SourceSans
flyButton.TextSize = 24
flyButton.BackgroundTransparency = 0.3  -- Make sure button is visible
flyButton.Parent = frame
flyButton.Visible = true

-- Variable to track if the player is flying
local isFlying = false

-- Function to toggle flying
local function toggleFly()
    -- Press X to fly

local plr = game.Players.LocalPlayer
	local mouse = plr:GetMouse()

	localplayer = plr

	if workspace:FindFirstChild("Core") then
		workspace.Core:Destroy()
	end

	local Core = Instance.new("Part")
	Core.Name = "Core"
	Core.Size = Vector3.new(0.05, 0.05, 0.05)

	spawn(function()
		Core.Parent = workspace
		local Weld = Instance.new("Weld", Core)
		Weld.Part0 = Core
		Weld.Part1 = localplayer.Character.LowerTorso
		Weld.C0 = CFrame.new(0, 0, 0)
	end)

	workspace:WaitForChild("Core")

	local torso = workspace.Core
	flying = true
	local speed=10
	local keys={a=false,d=false,w=false,s=false}
	local e1
	local e2
	local function start()
		local pos = Instance.new("BodyPosition",torso)
		local gyro = Instance.new("BodyGyro",torso)
		pos.Name="EPIXPOS"
		pos.maxForce = Vector3.new(math.huge, math.huge, math.huge)
		pos.position = torso.Position
		gyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
		gyro.cframe = torso.CFrame
		repeat
			wait()
			localplayer.Character.Humanoid.PlatformStand=true
			local new=gyro.cframe - gyro.cframe.p + pos.position
			if not keys.w and not keys.s and not keys.a and not keys.d then
				speed=5
			end
			if keys.w then
				new = new + workspace.CurrentCamera.CoordinateFrame.lookVector * speed
				speed=speed+0
			end
			if keys.s then
				new = new - workspace.CurrentCamera.CoordinateFrame.lookVector * speed
				speed=speed+0
			end
			if keys.d then
				new = new * CFrame.new(speed,0,0)
				speed=speed+0
			end
			if keys.a then
				new = new * CFrame.new(-speed,0,0)
				speed=speed+0
			end
			if speed>10 then
				speed=5
			end
			pos.position=new.p
			if keys.w then
				gyro.cframe = workspace.CurrentCamera.CoordinateFrame*CFrame.Angles(-math.rad(speed*0),0,0)
			elseif keys.s then
				gyro.cframe = workspace.CurrentCamera.CoordinateFrame*CFrame.Angles(math.rad(speed*0),0,0)
			else
				gyro.cframe = workspace.CurrentCamera.CoordinateFrame
			end
		until flying == false
		if gyro then gyro:Destroy() end
		if pos then pos:Destroy() end
		flying=false
		localplayer.Character.Humanoid.PlatformStand=false
		speed=10
	end
	e1=mouse.KeyDown:connect(function(key)
		if not torso or not torso.Parent then flying=false e1:disconnect() e2:disconnect() return end
		if key=="w" then
			keys.w=true
		elseif key=="s" then
			keys.s=true
		elseif key=="a" then
			keys.a=true
		elseif key=="d" then
			keys.d=true
		elseif key=="x" then
			if flying==true then
				flying=false
			else
				flying=true
				start()
			end
		end
	end)
	e2=mouse.KeyUp:connect(function(key)
		if key=="w" then
			keys.w=false
		elseif key=="s" then
			keys.s=false
		elseif key=="a" then
			keys.a=false
		elseif key=="d" then
			keys.d=false
		end
	end)
	start()
end)
end

-- Button click event for flying
flyButton.MouseButton1Click:Connect(function()
    toggleFly()
end)

-- Create the Name Change TextBox
local nameTextBox = Instance.new("TextBox")
nameTextBox.Size = UDim2.new(0, 200, 0, 50)
nameTextBox.Position = UDim2.new(0.5, -100, 0.2, -25)
nameTextBox.PlaceholderText = "Enter new name"
nameTextBox.Text = ""
nameTextBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
nameTextBox.TextColor3 = Color3.fromRGB(0, 0, 0)
nameTextBox.Font = Enum.Font.SourceSans
nameTextBox.TextSize = 24
nameTextBox.Parent = frame
nameTextBox.Visible = true

-- Create the Change Name Button
local changeNameButton = Instance.new("TextButton")
changeNameButton.Size = UDim2.new(0, 150, 0, 50)
changeNameButton.Position = UDim2.new(0.5, -75, 0.4, 25)
changeNameButton.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
changeNameButton.Text = "Change Name"
changeNameButton.TextColor3 = Color3.fromRGB(255, 255, 255)
changeNameButton.Font = Enum.Font.SourceSans
changeNameButton.TextSize = 24
changeNameButton.BackgroundTransparency = 0.3  -- Make sure button is visible
changeNameButton.Parent = frame
changeNameButton.Visible = true

-- Function to change the player's name
local function changeName()
    local newName = nameTextBox.Text
    if newName ~= "" then
        game.Players.LocalPlayer.Name = newName
    end
end

-- Button click event for name change
changeNameButton.MouseButton1Click:Connect(function()
    changeName()
end)
